#!/usr/bin/with-contenv bashio
set -euo pipefail

# Validate required configuration
if [[ -z "$(bashio::config 'stream_key')" ]]; then
  bashio::log.fatal "Configuration 'stream_key' is required and cannot be empty."
  exit 1
fi

# Provide info logs
PRINTER_URL="$(bashio::config 'printer_url')"
STATUS_URL="$(echo "${PRINTER_URL}" | sed -E 's#^(https?://[^/]+).*#\1#')"
bashio::log.info "Printer URL: ${PRINTER_URL} (status check: ${STATUS_URL})"
bashio::log.info "Check interval: $(bashio::config 'check_interval') seconds"
bashio::log.info "RTMP endpoint: rtmp://rtmp.deployor.dev:1935/live/<stream_key>"

# Networking note
bashio::log.info "Note: This add-on is designed for host network mode. If you cannot reach 192.168.x.x addresses, ensure host_network: true in the add-on manifest and rebuild the add-on."